<!--
  
Base class for some of the elements in the Basic Web Components collection.

This provides some services which aren't provided by the browser or Polymer.
Right now, this includes:

* Generic styling. A "generic" attribute, which defaults to true, allows
  elements to receive baseline styling that can easily be removed by setting
  "generic" to false.

* contentChanged. A callback invoked when an element's light DOM content changes.

-->

<link rel="import" href="../polymer/polymer.html">

<polymer-element name="basic-element" attributes="generic">

<script>
// Basic helpers.
window.BasicWebComponents = {

  // Extend the given set of members with the helpers and return the result.
  extend: function( options ) {
    options = options || {};
    for ( var key in BasicWebComponents ) {
      if ( !options[ key ] ) {
        options[ key ] = BasicWebComponents[ key ];
      }
    }
    return options;
  },

  // Helper function to log output to the console, prefixed by the element's
  // tag. This makes it easier to see which element is logging the output.
  log: function( s ) {
    if ( console ) {
      console.log( this.localName + ": " + s );
    }
  },

  ready: function() {
    this.super();
    this.setup();
  },

  setup: function() {

    // If the element has a contentChanged handler, then wire up an observer for
    // content change events.
    if ( this.contentChanged ) {
      this._observeContentChanged();
      if ( this.childNodes.length > 0 ) {
        // Consider any initial content of a new element to be "changed" content
        // and invoke the callback so the element can do any corresponding setup.
        this.contentChanged();
      }
    }

    // We explicitly set the generic attribute to true, rather than providing
    // that as a default value. A default value won't appear on an element
    // instance as an attribute, but an attribute we set explicitly will. We
    // need the attribute there so that generic styling can be set simply by
    // defining rules like
    //
    //   :host([generic]) {
    //     ...
    //   }
    //
    if ( this.generic == null ) {
      this.generic = true;
    }
  },

  // Wire up an observer for (light DOM) content change events.
  _observeContentChanged: function() {
    var observer = new MutationObserver( function() {
      this.contentChanged();
    }.bind( this ));
    observer.observe( this, {
      characterData: true,
      childList: true,
      subtree: true
    });
  }

};

Polymer( "basic-element", BasicWebComponents.extend() );
</script>

</polymer-element>
